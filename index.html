<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblia Pro v4</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="data/cornilescu.js"></script>

    <style>
        :root { --p: #1a2a6c; --a: #b21f1f; --s: #28a745; }
        body { background: #f4f7f6; font-family: sans-serif; padding-bottom: 50px; }
        .header-bg { background: white; padding: 15px; text-align: center; border-bottom: 3px solid var(--p); }
        .card-custom { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-top: 20px; }
        .quiz-btn { width: 100%; margin-bottom: 10px; padding: 12px; border-radius: 10px; border: 2px solid #eee; background: white; font-weight: bold; text-align: left; }
        .ref-box { background: #fff5f5; color: #b21f1f; padding: 10px; border-radius: 10px; margin-top: 10px; font-style: italic; font-size: 0.9rem; text-align: center; border: 1px dashed #b21f1f; }
    </style>
</head>
<body>

<div class="header-bg shadow-sm">
    <h4 style="font-weight: 800; color: var(--p); margin: 0;">BIBLIA <span style="color: var(--a);">PRO</span></h4>
</div>

<div class="container">
    <ul class="nav nav-pills nav-justified mt-3 shadow-sm bg-white rounded-pill p-1" id="mainNav">
        <li class="nav-item"><button class="nav-link active rounded-pill" data-bs-toggle="tab" data-bs-target="#tab-daily">ASTƒÇZI</button></li>
        <li class="nav-item"><button class="nav-link rounded-pill" data-bs-toggle="tab" data-bs-target="#tab-read" onclick="initRead()">CITIRE</button></li>
        <li class="nav-item"><button class="nav-link rounded-pill" data-bs-toggle="tab" data-bs-target="#tab-quiz">QUIZ</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-daily">
            <div class="card-custom text-center">
                <p id="v-text" class="fs-5">Se √ÆncarcƒÉ Biblia...</p>
                <h6 id="v-ref" class="fw-bold text-primary"></h6>
                <button onclick="genereazaVerset()" class="btn btn-outline-primary btn-sm mt-3 px-4">Alt verset</button>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-read">
            <div class="card-custom">
                <div class="row g-2 mb-3">
                    <div class="col-7"><select id="sel-c" class="form-select" onchange="updateCap()"></select></div>
                    <div class="col-5"><select id="sel-cap" class="form-select" onchange="showCap()"></select></div>
                </div>
                <div id="biblie-display" style="line-height: 1.8; max-height: 60vh; overflow-y: auto;"></div>
            </div>
        </div>

        <div class="tab-pane fade" id="tab-quiz">
            <div id="quiz-init" class="card-custom text-center">
                <h6>Introdu numele tƒÉu:</h6>
                <input type="text" id="u-name" class="form-control mb-3 text-center" placeholder="Ex: Alexandra">
                <button onclick="startQuiz()" class="btn btn-primary w-100 fw-bold">START QUIZ (30 √éNTREBƒÇRI)</button>
            </div>

            <div id="quiz-play" class="card-custom d-none">
                <div class="d-flex justify-content-between small border-bottom mb-3 pb-2">
                    <span id="p-name" class="fw-bold text-primary"></span>
                    <span id="p-count" class="fw-bold text-muted">1/30</span>
                </div>
                <div id="q-area">
                    <h5 id="q-text" class="fw-bold text-center mb-4"></h5>
                    <div id="q-options"></div>
                    <div id="q-result"></div>
                </div>
                <div id="q-final" class="d-none text-center">
                    <h2 class="fw-bold">GATA! üéâ</h2>
                    <p id="q-score" class="fs-4"></p>
                    <button onclick="location.reload()" class="btn btn-primary px-5">RESTART</button>
                </div>
                <hr>
                <button onclick="loadMyAnswers()" class="btn btn-sm btn-link w-100">RƒÉspunsurile mele (Supabase)</button>
                <div id="my-history" class="mt-2 small d-none" style="max-height: 150px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const S_URL = "https://tlfvklpexmglgkhuxyxp.supabase.co";
    const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsZnZrbHBleG1nbGdraHV4eXhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NjIxMjgsImV4cCI6MjA4NzQzODEyOH0.Vj7b_VsE9jCU5j3vW7EaOb2MGeWL8cbYPkkI3kuPeMY";
    
    let user = "", scor = 0, indexIntrebare = 0, listaIntrebari = [];

    const intrebariBiblice = [
        { q: "Cine l-a trƒÉdat pe Isus pentru 30 de argin»õi?", a: ["Iuda Iscarioteanul", "Petru", "Ioan", "Toma"], c: 0, r: "Matei 26:14-16" },
        { q: "Unde S-a nƒÉscut Isus Hristos?", a: ["Ierusalim", "Nazaret", "Betleem", "Ierihon"], c: 2, r: "Matei 2:1" },
        { q: "Moise a despƒÉr»õit apele MƒÉrii Ro»ôii.", a: ["AdevƒÉrat", "Fals"], c: 0, r: "Exod 14:21-22" },
        { q: "C√¢te zile a plouat √Æn timpul potopului lui Noe?", a: ["7 zile", "12 zile", "40 de zile", "100 de zile"], c: 2, r: "Geneza 7:12" },
        { q: "Care a fost prima minune a lui Isus?", a: ["Vindecarea", "P√¢inile", "Apa √Æn vin", "Mersul pe apƒÉ"], c: 2, r: "Ioan 2:11" },
        { q: "Cine l-a ucis pe uria»ôul Goliat?", a: ["Saul", "David", "Samson", "Ghedeon"], c: 1, r: "1 Samuel 17:50" },
        { q: "C√¢»õi ucenici principali a avut Isus?", a: ["10", "12", "7", "40"], c: 1, r: "Matei 10:1" },
        { q: "Care este prima carte a Bibliei?", a: ["Exod", "Levitic", "Geneza", "Psalmi"], c: 2, r: "Geneza 1:1" },
        { q: "Cine a fost aruncat √Æn groapa cu lei?", a: ["Iov", "Daniel", "Iona", "Iosif"], c: 1, r: "Daniel 6:16" },
        { q: "Ce mare a mers Isus pe jos?", a: ["Marea Ro»ôie", "Marea MoartƒÉ", "Marea Galileii", "Marea MediteranƒÉ"], c: 2, r: "Matei 14:25" },
        { q: "Cine a primit Cele Zece Porunci?", a: ["Avraam", "Isaac", "Moise", "Iacov"], c: 2, r: "Exod 20" },
        { q: "Care era ocupa»õia lui Petru √Ænainte de a deveni ucenic?", a: ["Vame»ô", "T√¢mplar", "Pescar", "PƒÉstor"], c: 2, r: "Matei 4:18" },
        { q: "Cine a construit corabia pentru potop?", a: ["Enoh", "Noe", "Lameh", "Matusalem"], c: 1, r: "Geneza 6:13-14" },
        { q: "Cum se numea muntele unde a fost rƒÉstignit Isus?", a: ["Sinai", "Golgota", "Horeb", "Tabor"], c: 1, r: "Matei 27:33" },
        { q: "Cine a fost so»õia lui Adam?", a: ["Sara", "Rahela", "Eva", "Estera"], c: 2, r: "Geneza 3:20" },
        { q: "C√¢te plƒÉgi au lovit Egiptul?", a: ["7", "12", "10", "3"], c: 2, r: "Exod 7-12" },
        { q: "Cine a fost cel mai √Æn»õelept rege al Israelului?", a: ["Saul", "David", "Solomon", "Ezechia"], c: 2, r: "1 √émpƒÉra»õi 3:12" },
        { q: "√én ce ora»ô au fost numi»õi ucenicii 'cre»ôtini' prima datƒÉ?", a: ["Ierusalim", "Antiohia", "Roma", "Efes"], c: 1, r: "Fapte 11:26" },
        { q: "Cine l-a botezat pe Isus?", a: ["Petru", "Ioan BotezƒÉtorul", "Pavel", "Iacov"], c: 1, r: "Matei 3:13" },
        { q: "Care este ultima carte a Bibliei?", a: ["Evrei", "Iuda", "Apocalipsa", "Maleahi"], c: 2, r: "Apocalipsa 1:1" },
        { q: "Cine a fost fratele lui Moise?", a: ["Iosua", "Aaron", "Caleb", "Eleazar"], c: 1, r: "Exod 4:14" },
        { q: "C√¢te p√¢ini »ôi c√¢»õi pe»ôti a folosit Isus pentru a hrƒÉni 5000 de oameni?", a: ["7 p√¢ini/2 pe»ôti", "5 p√¢ini/2 pe»ôti", "12 p√¢ini/5 pe»ôti", "3 p√¢ini/1 pe»ôte"], c: 1, r: "Matei 14:17" },
        { q: "Cine a scris cele mai multe epistole √Æn Noul Testament?", a: ["Petru", "Ioan", "Pavel", "Luca"], c: 2, r: "Fapte" },
        { q: "Ce animal a vorbit cu Balaam?", a: ["Un leu", "Un mƒÉgar", "Un »ôarpe", "Un miel"], c: 1, r: "Numeri 22:28" },
        { q: "Cine a fost v√¢ndut de fra»õii sƒÉi √Æn Egipt?", a: ["Benjamin", "Iosif", "Reuben", "Simeon"], c: 1, r: "Geneza 37:28" },
        { q: "C√¢t timp a stat Iona √Æn p√¢ntecele pe»ôtelui?", a: ["1 zi", "7 zile", "3 zile »ôi 3 nop»õi", "40 de zile"], c: 2, r: "Iona 1:17" },
        { q: "Cine a fost mama lui Isus?", a: ["Elisabeta", "Marta", "Maria", "Magdalena"], c: 2, r: "Luca 1:30-31" },
        { q: "Din ce a fost fƒÉcutƒÉ Eva?", a: ["Din »õƒÉr√¢nƒÉ", "Dintr-o coastƒÉ", "Din aur", "Din suflare"], c: 1, r: "Geneza 2:22" },
        { q: "Cine a fost primul martir cre»ôtin?", a: ["»òtefan", "Iacov", "Filip", "Pavel"], c: 0, r: "Fapte 7:59" },
        { q: "Ce r√¢u a fost folosit pentru botezul lui Isus?", a: ["Nil", "Eufrat", "Iordan", "Tigru"], c: 2, r: "Matei 3:13" }
    ];

    // -- LOGICA VERSET --
    function genereazaVerset() {
        if (window.bibleData) {
            const v = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
            document.getElementById('v-text').innerText = v.text;
            document.getElementById('v-ref').innerText = `${v.book_name} ${v.chapter}:${v.verse}`;
        }
    }
    window.onload = () => setTimeout(genereazaVerset, 500);

    // -- LOGICA QUIZ --
    function startQuiz() {
        user = document.getElementById('u-name').value.trim();
        if(user.length < 2) return alert("Introdu un nume!");
        listaIntrebari = [...intrebariBiblice].sort(() => Math.random() - 0.5);
        document.getElementById('quiz-init').classList.add('d-none');
        document.getElementById('quiz-play').classList.remove('d-none');
        document.getElementById('p-name').innerText = "üë§ " + user;
        afiseazaQ();
    }

    function afiseazaQ() {
        if(indexIntrebare >= 30) {
            document.getElementById('q-area').classList.add('d-none');
            document.getElementById('q-final').classList.remove('d-none');
            document.getElementById('q-score').innerText = `Scor: ${scor} / 30`;
            return;
        }
        const current = listaIntrebari[indexIntrebare];
        document.getElementById('p-count').innerText = `${indexIntrebare + 1}/30`;
        document.getElementById('q-text').innerText = current.q;
        document.getElementById('q-result').innerHTML = "";
        const container = document.getElementById('q-options');
        container.innerHTML = "";

        current.a.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = "quiz-btn shadow-sm";
            btn.innerText = opt;
            btn.onclick = () => {
                const bts = container.querySelectorAll('button');
                bts.forEach(b => b.disabled = true);
                if(i === current.c) {
                    scor++;
                    btn.style.borderColor = "var(--s)"; btn.style.background = "#e8f5e9";
                    document.getElementById('q-result').innerHTML = `<div class="text-success text-center fw-bold">Corect! ‚úÖ</div><div class="ref-box">${current.r}</div>`;
                } else {
                    btn.style.borderColor = "var(--a)"; btn.style.background = "#ffebee";
                    document.getElementById('q-result').innerHTML = `<div class="text-danger text-center fw-bold">Gre»ôit! (Era: ${current.a[current.c]}) ‚ùå</div><div class="ref-box">${current.r}</div>`;
                }
                saveToSupabase(current.q, (i === current.c ? "Corect" : "Gresit"));
                indexIntrebare++;
                setTimeout(afiseazaQ, 3000);
            };
            container.appendChild(btn);
        });
    }

    async function saveToSupabase(q, r) {
        fetch(`${S_URL}/rest/v1/scoruri`, {
            method: "POST",
            headers: { "apikey": S_KEY, "Authorization": `Bearer ${S_KEY}`, "Content-Type": "application/json" },
            body: JSON.stringify({ nume: user, intrebare: q, rezultat: r })
        });
    }

    async function loadMyAnswers() {
        const box = document.getElementById('my-history');
        box.classList.toggle('d-none');
        box.innerHTML = "Se √ÆncarcƒÉ...";
        const res = await fetch(`${S_URL}/rest/v1/scoruri?nume=eq.${user}&order=created_at.desc`, {
            headers: { "apikey": S_KEY, "Authorization": `Bearer ${S_KEY}` }
        });
        const data = await res.json();
        box.innerHTML = data.map(d => `<div><b>${d.rezultat}:</b> ${d.intrebare}</div>`).join('');
    }

    // -- LOGICA BIBLIE --
    function initRead() {
        if(!window.bibleData) return;
        const selC = document.getElementById('sel-c');
        if(selC.options.length > 0) return;
        const carti = [...new Set(bibleData.verses.map(v => v.book_name))];
        carti.forEach(c => selC.add(new Option(c, c)));
        updateCap();
    }
    function updateCap() {
        const c = document.getElementById('sel-c').value;
        const caps = [...new Set(bibleData.verses.filter(v => v.book_name === c).map(v => v.chapter))];
        const sc = document.getElementById('sel-cap');
        sc.innerHTML = "";
        caps.forEach(cp => sc.add(new Option("Cap. " + cp, cp)));
        showCap();
    }
    function showCap() {
        const c = document.getElementById('sel-c').value, cp = document.getElementById('sel-cap').value;
        const vers = bibleData.verses.filter(v => v.book_name === c && v.chapter == cp);
        document.getElementById('biblie-display').innerHTML = vers.map(v => `<span class="me-2"><b class="text-danger small">${v.verse}</b> ${v.text}</span>`).join('');
    }
</script>

</body>
</html>
