<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Biblia Pro - Quiz & Studiu</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Lora:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="data/cornilescu.js"></script>

    <style>
        :root { --p: #1a2a6c; --a: #b21f1f; --s: #28a745; }
        body, html { background: #f4f7f6; margin: 0; padding: 0; font-family: 'Lora', serif; overflow-x: hidden; }
        header { background: white; padding: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-custom { background: white; border-radius: 50px; padding: 3px; display: inline-flex; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin: 15px auto; }
        .nav-link { border-radius: 50px !important; font-weight: bold; color: #666; padding: 7px 12px !important; font-size: 0.75rem; border: none !important; }
        .nav-link.active { background: var(--p) !important; color: white !important; }
        .card-premium { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: none; }
        .quiz-btn { padding: 12px !important; margin-bottom: 10px; border-radius: 12px !important; width: 100%; transition: 0.2s; border: 2px solid #eee; font-weight: bold !important; background: white; text-align: left; }
        #q-txt { font-family: 'Montserrat', sans-serif; font-weight: 700; color: #2c3e50; min-height: 60px; text-align: center; font-size: 1.1rem; }
        .score-box { background: #e8f5e9; color: #2e7d32; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        
        #citire-text { line-height: 1.8; max-height: 65vh; overflow-y: auto; text-align: justify; scroll-behavior: smooth; }
        .verset-wrapper { position: relative; cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: 0.3s; display: inline; }
        .verset-wrapper.highlight { background-color: #fff3cd; border-bottom: 1px solid #ffeeba; }
        .save-icon { color: #ccc; font-size: 0.8rem; margin-left: 5px; cursor: pointer; }
        .save-icon:hover { color: var(--a); }
        .saved-item { border-left: 4px solid var(--a); padding-left: 10px; margin-bottom: 15px; font-size: 0.9rem; position: relative; }
        .ref-hint { font-size: 0.85rem; color: var(--a); font-weight: bold; display: block; margin-top: 5px; }
        .ref-link { text-decoration: underline; cursor: pointer; color: var(--a); }
        .ref-instruction { font-weight: normal; font-size: 0.75rem; color: #888; font-style: italic; }
    </style>
</head>
<body>

<header>
    <h6 style="color: var(--p); font-family: 'Montserrat'; margin: 0; font-weight: 800; letter-spacing: 1px;">
        BIBLIA <span style="color: var(--a);">PRO</span>
    </h6>
</header>

<div class="container py-2 text-center">
    <div class="nav-custom shadow-sm">
        <ul class="nav nav-pills" id="pills-tab">
            <li class="nav-item"><button class="nav-link active" id="btn-daily" data-bs-toggle="pill" data-bs-target="#daily">AST캑ZI</button></li>
            <li class="nav-item"><button class="nav-link" id="btn-read" data-bs-toggle="pill" data-bs-target="#read" onclick="initRead()">CITIRE</button></li>
            <li class="nav-item"><button class="nav-link" id="btn-saved" data-bs-toggle="pill" data-bs-target="#saved" onclick="afiseazaSalvate()">SALVATE</button></li>
            <li class="nav-item"><button class="nav-link" id="btn-quiz" data-bs-toggle="pill" data-bs-target="#quiz">QUIZ</button></li>
        </ul>
    </div>

    <div class="tab-content text-start">
        <div class="tab-pane fade show active" id="daily">
            <div class="card-premium text-center">
                <i class="fas fa-quote-left mb-3" style="color: #ddd; font-size: 2rem;"></i>
                <p id="rand-text" style="font-size: 1.2rem; color: #333; font-style: italic;">Se 칥ncarc캒...</p>
                <h6 id="rand-ref" class="fw-bold mt-2" style="color: var(--p);"></h6>
                <button onclick="genereazaVerset()" class="btn btn-sm btn-primary rounded-pill mt-3 px-4 shadow-sm">ALT VERSET</button>
            </div>
        </div>

        <div class="tab-pane fade" id="read">
            <div class="card-premium p-2 mb-2 sticky-top" style="top: 60px; background: #f4f7f6; z-index: 5;">
                <div class="d-flex gap-1">
                    <select id="sel-c" class="form-select form-select-sm" onchange="updateCap()"></select>
                    <select id="sel-cap" class="form-select form-select-sm" onchange="showCap()"></select>
                    <select id="sel-v" class="form-select form-select-sm" onchange="sariLaVerset()"></select>
                </div>
            </div>
            <div id="citire-text" class="card-premium">Selecteaz캒 o carte pentru a 칥ncepe lectura.</div>
        </div>

        <div class="tab-pane fade" id="saved">
            <div class="card-premium">
                <h5 class="fw-bold mb-3" style="color: var(--p);"><i class="fas fa-bookmark me-2 text-danger"></i>Versete Salvate</h5>
                <div id="lista-salvate">
                    <p class="text-muted small">Nu ai salvat nimic.</p>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="quiz">
            <div id="quiz-login" class="card-premium text-center">
                <h5 class="fw-bold mb-3">Provocarea Biblic캒</h5>
                <input type="text" id="user-name" class="form-control mb-3 text-center rounded-pill" placeholder="Numele t캒u">
                <button onclick="startQuizFlow()" class="btn btn-primary w-100 rounded-pill fw-bold py-2 mb-2">START QUIZ (30 칉ntreb캒ri)</button>
                <button onclick="setNumeSiVezi()" class="btn btn-outline-secondary btn-sm w-100 rounded-pill">VEZI DOAR ISTORICUL MEU</button>
            </div>

            <div id="quiz-box" class="card-premium d-none">
                <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                    <span id="player-display" class="fw-bold text-primary small"></span>
                    <span id="score-display" class="score-box small">Scor: 0</span>
                </div>
                
                <div id="quiz-content"> 
                    <div id="q-txt"></div>
                    <div id="q-opts" class="mt-3"></div>
                    <div id="q-res" class="mt-3" style="min-height: 50px;"></div>
                    <hr>
                    <button onclick="veziRezultate()" class="btn btn-light btn-sm w-100 text-muted">Verific캒 rezultatele mele</button>
                </div>

                <div id="tabel-rezultate" class="mt-4 d-none">
                    <h6 class="fw-bold border-bottom pb-2"><i class="fas fa-history me-2"></i>Istoric R캒spunsuri</h6>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-sm hover">
                            <tbody id="lista-scoruri-body"></tbody>
                        </table>
                    </div>
                    <button onclick="location.reload()" class="btn btn-link btn-sm w-100 mt-2">Restart Joc</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SUPABASE_BASE_URL = "https://tlfvklpexmglgkhuxyxp.supabase.co/rest/v1"; 
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsZnZrbHBleG1nbGdraHV4eXhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NjIxMjgsImV4cCI6MjA4NzQzODEyOH0.Vj7b_VsE9jCU5j3vW7EaOb2MGeWL8cbYPkkI3kuPeMY";

    let userName = "", score = 0, quizBlocat = false, intrebariSession = [], pasActual = 0;

    function genereazaVerset() {
        if (typeof bibleData !== 'undefined') {
            const v = bibleData.verses[Math.floor(Math.random() * bibleData.verses.length)];
            document.getElementById('rand-text').innerText = v.text;
            document.getElementById('rand-ref').innerText = v.book_name + " " + v.chapter + ":" + v.verse;
        }
    }
    window.addEventListener('load', genereazaVerset);

    function salveazaVerset(book, cap, vNum, text) {
        let salvate = JSON.parse(localStorage.getItem('biblia_salvate') || '[]');
        const ref = `${book} ${cap}:${vNum}`;
        if (!salvate.some(s => s.ref === ref)) {
            salvate.push({ ref, text });
            localStorage.setItem('biblia_salvate', JSON.stringify(salvate));
            alert("Verset salvat!");
        } else { alert("Deja salvat."); }
    }

    function afiseazaSalvate() {
        const container = document.getElementById('lista-salvate');
        let salvate = JSON.parse(localStorage.getItem('biblia_salvate') || '[]');
        if (salvate.length === 0) { container.innerHTML = '<p class="text-muted small">Nu ai salvat nimic.</p>'; return; }
        container.innerHTML = salvate.map((v, index) => `
            <div class="saved-item">
                <div class="fw-bold text-primary" style="font-size:0.8rem; cursor:pointer" onclick="navigheazaLaReferinta('${v.ref}')">${v.ref} <span class="ref-instruction">(apas캒)</span></div>
                <div>${v.text}</div>
                <button onclick="stergeVerset(${index})" class="btn btn-sm text-danger p-0 mt-1" style="font-size:0.7rem;">탲terge</button>
            </div>
        `).join('');
    }

    function stergeVerset(index) {
        let salvate = JSON.parse(localStorage.getItem('biblia_salvate') || '[]');
        salvate.splice(index, 1);
        localStorage.setItem('biblia_salvate', JSON.stringify(salvate));
        afiseazaSalvate();
    }

    function navigheazaLaReferinta(refString) {
        const parts = refString.match(/^(.+?)\s(\d+):(\d+)/);
        if (!parts) return;
        const carte = parts[1].trim();
        const capitol = parts[2];
        const verset = parts[3];
        const triggerEl = document.querySelector('#btn-read');
        const tab = new bootstrap.Tab(triggerEl);
        tab.show();
        initRead();
        document.getElementById('sel-c').value = carte;
        updateCap();
        document.getElementById('sel-cap').value = capitol;
        showCap();
        setTimeout(() => {
            document.getElementById('sel-v').value = verset;
            sariLaVerset();
        }, 300);
    }

    function initRead() {
        if (typeof bibleData === 'undefined') return;
        const sc = document.getElementById('sel-c');
        if (sc.options.length > 0) return;
        [...new Set(bibleData.verses.map(v => v.book_name))].forEach(c => sc.add(new Option(c, c)));
        updateCap();
    }
    
    function updateCap() {
        const c = document.getElementById('sel-c').value;
        const caps = [...new Set(bibleData.verses.filter(v => v.book_name === c).map(v => v.chapter))];
        const sc = document.getElementById('sel-cap');
        sc.innerHTML = "";
        caps.forEach(cp => sc.add(new Option("Cap. " + cp, cp)));
        showCap();
    }

    function showCap() {
        const c = document.getElementById('sel-c').value;
        const cp = document.getElementById('sel-cap').value;
        const vers = bibleData.verses.filter(v => v.book_name === c && v.chapter == cp);
        const sv = document.getElementById('sel-v');
        sv.innerHTML = '<option value="">Verset...</option>';
        vers.forEach(v => sv.add(new Option("V. " + v.verse, v.verse)));
        document.getElementById('citire-text').innerHTML = vers.map(v => `
            <span id="v-${v.verse}" class="verset-wrapper" onclick="evidentiazaVerset(this)">
                <b style="color:var(--a); font-size:0.8rem;">${v.verse}</b> ${v.text}
                <i class="fas fa-bookmark save-icon" onclick="salveazaVerset('${v.book_name}', ${v.chapter}, ${v.verse}, '${v.text.replace(/'/g, "\\'")}')"></i>
            </span>
        `).join(' ');
        document.getElementById('citire-text').scrollTop = 0;
    }

    function evidentiazaVerset(el) {
        document.querySelectorAll('.verset-wrapper').forEach(v => v.classList.remove('highlight'));
        el.classList.add('highlight');
    }

    function sariLaVerset() {
        const vNum = document.getElementById('sel-v').value;
        if(!vNum) return;
        const el = document.getElementById(`v-${vNum}`);
        if(el) {
            evidentiazaVerset(el);
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function startQuizFlow() {
        const input = document.getElementById('user-name');
        if(input.value.trim().length < 2) { alert("Nume invalid!"); return; }
        userName = input.value.trim();
        intrebariSession = [...intrebariBiblice].sort(() => 0.5 - Math.random());
        document.getElementById('quiz-login').classList.add('d-none');
        document.getElementById('quiz-box').classList.remove('d-none');
        document.getElementById('player-display').innerText = "游녻 " + userName;
        startQuiz();
    }

    function setNumeSiVezi() {
        const input = document.getElementById('user-name');
        if(input.value.trim().length < 2) { alert("Nume!"); return; }
        userName = input.value.trim();
        document.getElementById('quiz-login').classList.add('d-none');
        document.getElementById('quiz-box').classList.remove('d-none');
        document.getElementById('quiz-content').classList.add('d-none');
        document.getElementById('player-display').innerText = "游녻 " + userName;
        veziRezultate();
    }

    async function trimiteDate(intrebare, rezultat) {
        try {
            await fetch(`${SUPABASE_BASE_URL}/scoruri`, {
                method: "POST",
                headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}`, "Content-Type": "application/json", "Prefer": "return=minimal" },
                body: JSON.stringify({ nume: userName, intrebare: intrebare, rezultat: rezultat })
            });
        } catch (e) { console.error(e); }
    }

    function startQuiz() {
        if (pasActual >= 30) {
            document.getElementById('q-txt').innerHTML = "<span class='text-success'>Final!</span>";
            document.getElementById('q-opts').innerHTML = "";
            veziRezultate();
            return;
        }
        quizBlocat = false;
        const intr = intrebariSession[pasActual];
        pasActual++;
        document.getElementById('q-txt').innerText = pasActual + ". " + intr.q;
        document.getElementById('q-res').innerText = "";
        const od = document.getElementById('q-opts');
        od.innerHTML = "";
        intr.a.forEach((raspuns, index) => {
            let b = document.createElement('button');
            b.className = "quiz-btn shadow-sm";
            b.innerText = raspuns;
            b.onclick = () => {
                if(quizBlocat) return;
                quizBlocat = true;
                let esteCorect = (index === intr.c);
                if(esteCorect) { score++; b.style.background = "#d4edda"; } 
                else { b.style.background = "#f8d7da"; document.getElementById('q-res').innerHTML = `<small class='text-danger'>Corect: ${intr.a[intr.c]}</small>`; }
                document.getElementById('score-display').innerText = "Scor: " + score;
                trimiteDate(intr.q, esteCorect ? "Corect" : "Gresit");
                setTimeout(startQuiz, 2000);
            };
            od.appendChild(b);
        });
    }

    async function veziRezultate() {
        const tabelContainer = document.getElementById('tabel-rezultate');
        const listaBody = document.getElementById('lista-scoruri-body');
        tabelContainer.classList.remove('d-none');
        listaBody.innerHTML = "<tr><td colspan='2' class='text-center p-4'>Se 칥ncarc캒...</td></tr>";
        try {
            const url = `${SUPABASE_BASE_URL}/scoruri?nume=eq.${encodeURIComponent(userName)}`;
            const response = await fetch(url, { method: "GET", headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}`, "Accept": "application/json" } });
            const date = await response.json();
            date.sort((a, b) => b.id - a.id);
            listaBody.innerHTML = "";
            date.forEach(rand => {
                const esteCorect = (rand.rezultat === "Corect");
                const badgeClass = esteCorect ? "bg-success" : "bg-danger";
                const infoIntrebare = intrebariBiblice.find(i => i.q === rand.intrebare);
                const referinta = (!esteCorect && infoIntrebare) ? `<div class="ref-hint">Vezi: <span class="ref-link" onclick="navigheazaLaReferinta('${infoIntrebare.r}')">${infoIntrebare.r}</span> <span class="ref-instruction">(apas캒 pentru citire)</span></div>` : "";

                listaBody.innerHTML += `
                    <tr>
                        <td style="padding: 10px 0;">
                            <div style="font-size: 0.85rem; font-weight: 600;">${rand.intrebare}</div>
                            ${referinta}
                        </td>
                        <td class="text-end" style="vertical-align:middle;"><span class="badge ${badgeClass}">${rand.rezultat}</span></td>
                    </tr>`;
            });
        } catch (e) { listaBody.innerHTML = "<tr><td>Eroare!</td></tr>"; }
    }

    const intrebariBiblice = [
        { q: "Cine l-a tr캒dat pe Isus pentru 30 de argin탵i?", a: ["Iuda Iscarioteanul", "Petru", "Ioan", "Toma"], c: 0, r: "Matei 26:14" },
        { q: "Unde S-a n캒scut Isus Hristos?", a: ["Ierusalim", "Nazaret", "Betleem", "Ierihon"], c: 2, r: "Matei 2:1" },
        { q: "Moise a desp캒r탵it apele M캒rii Ro탳ii.", a: ["Adev캒rat", "Fals"], c: 0, r: "Exod 14:21" },
        { q: "C칙te zile a plouat 칥n timpul potopului lui Noe?", a: ["7 zile", "12 zile", "40 de zile", "100 de zile"], c: 2, r: "Geneza 7:12" },
        { q: "Care a fost prima minune a lui Isus?", a: ["Vindecarea", "P칙inile", "Apa 칥n vin", "Mersul pe ap캒"], c: 2, r: "Ioan 2:11" },
        { q: "Cine l-a ucis pe uria탳ul Goliat?", a: ["Saul", "David", "Samson", "Ghedeon"], c: 1, r: "1 Samuel 17:50" },
        { q: "C칙탵i ucenici principali a avut Isus?", a: ["10", "12", "7", "40"], c: 1, r: "Matei 10:1" },
        { q: "Care este prima carte a Bibliei?", a: ["Exod", "Levitic", "Geneza", "Psalmi"], c: 2, r: "Geneza 1:1" },
        { q: "Cine a fost aruncat 칥n groapa cu lei?", a: ["Iov", "Daniel", "Iona", "Iosif"], c: 1, r: "Daniel 6:16" },
        { q: "Pe ce mare a umblat Isus pe jos?", a: ["Marea Ro탳ie", "Marea Moart캒", "Marea Galileii", "Marea Mediteran캒"], c: 2, r: "Matei 14:25" },
        { q: "Cine a primit Cele Zece Porunci?", a: ["Avraam", "Isaac", "Moise", "Iacov"], c: 2, r: "Exod 20:1" },
        { q: "Care era ocupa탵ia lui Petru 칥nainte de a deveni ucenic?", a: ["Vame탳", "T칙mplar", "Pescar", "P캒stor"], c: 2, r: "Matei 4:18" },
        { q: "Cine a construit corabia pentru potop?", a: ["Enoh", "Noe", "Lameh", "Matusalem"], c: 1, r: "Geneza 6:14" },
        { q: "Cum se numea muntele unde a fost r캒stignit Isus?", a: ["Sinai", "Golgota", "Horeb", "Tabor"], c: 1, r: "Matei 27:33" },
        { q: "Cine a fost so탵ia lui Adam?", a: ["Sara", "Rahela", "Eva", "Estera"], c: 2, r: "Geneza 3:20" },
        { q: "C칙te urgii au lovit Egiptul?", a: ["7", "12", "10", "3"], c: 2, r: "Exod 7:1" },
        { q: "Cine a fost cel mai 칥n탵elept rege al Israelului?", a: ["Saul", "David", "Solomon", "Ezechia"], c: 2, r: "1 Imparati 3:12" },
        { q: "칉n ce ora탳 au fost numi탵i ucenicii 'cre탳tini' prima dat캒?", a: ["Ierusalim", "Antiohia", "Roma", "Efes"], c: 1, r: "Fapte 11:26" },
        { q: "Cine l-a botezat pe Isus?", a: ["Petru", "Ioan Botez캒torul", "Pavel", "Iacov"], c: 1, r: "Matei 3:13" },
        { q: "Care este ultima carte a Bibliei?", a: ["Evrei", "Iuda", "Apocalipsa", "Maleahi"], c: 2, r: "Apocalipsa 1:1" },
        { q: "Cine a fost fratele lui Moise?", a: ["Iosua", "Aaron", "Caleb", "Eleazar"], c: 1, r: "Exod 4:14" },
        { q: "C칙te p칙ini a folosit Isus pentru a hr캒ni 5000 de oameni?", a: ["7 p칙ini", "5 p칙ini", "12 p칙ini", "3 p칙ini"], c: 1, r: "Matei 14:17" },
        { q: "Cine a scris cele mai multe epistole 칥n Noul Testament?", a: ["Petru", "Ioan", "Pavel", "Luca"], c: 2, r: "Romani 1:1" },
        { q: "Ce animal a vorbit cu Balaam?", a: ["Un leu", "Un m캒gar", "Un 탳arpe", "Un miel"], c: 1, r: "Numeri 22:28" },
        { q: "Cine a fost v칙ndut de fra탵ii s캒i 칥n Egipt?", a: ["Benjamin", "Iosif", "Reuben", "Simeon"], c: 1, r: "Geneza 37:28" },
        { q: "C칙t timp a stat Iona 칥n p칙ntecele pe탳telui?", a: ["1 zi", "7 zile", "3 zile 탳i 3 nop탵i", "40 de zile"], c: 2, r: "Iona 1:17" },
        { q: "Cine a fost mama lui Isus?", a: ["Elisabeta", "Marta", "Maria", "Magdalena"], c: 2, r: "Luca 1:30" },
        { q: "Din ce a fost f캒cut캒 Eva?", a: ["Din 탵캒r칙n캒", "Dintr-o coast캒", "Din aur", "Din suflare"], c: 1, r: "Geneza 2:22" },
        { q: "Cine a fost primul martir cre탳tin?", a: ["탲tefan", "Iacov", "Filip", "Pavel"], c: 0, r: "Fapte 7:59" },
        { q: "Ce r칙u a fost folosit pentru botezul lui Isus?", a: ["Nil", "Eufrat", "Iordan", "Tigru"], c: 2, r: "Matei 3:13" }
    ];
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
